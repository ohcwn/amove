const hash=(()=>{class c extends Map{constructor(){super();this.cache="";this.read();window.addEventListener("hashchange",()=>{this.read()},{passive:!0})}read(){const a=window.location.hash.substring(1);this.cache!==a&&(super.clear(),a&&(a.split("&").forEach(b=>{super.set(...b.split("-",2))}),this.cache=a))}write(){let a="";super.forEach((b,d)=>{a&&(a+="&");a+=`${d}`;"undefined"!==typeof b&&(a+=`-${b}`)});this.cache=a;window.location.hash=a}has(a){return"id"===a?super.has("serial")||super.has("move"):
super.has(a)}get(a){if("id"===a){if(super.has("serial"))return`serial-${super.get("serial")}`;if(super.has("move"))return`move-${super.get("move")}`}return super.get(a)}set(a,b){if("id"===a){if("string"!==typeof b)return this;0===b.indexOf("serial-")?(super.delete("move"),super.set("serial",b.substring(7)),this.write()):0===b.indexOf("move-")&&(super.delete("serial"),super.set("move",b.substring(5)),this.write());return this}super.set(a,b);this.write();return this}delete(a){(a="id"===a?super.delete("serial")||
super.delete("move"):super.delete(a))&&this.write();return a}clear(){const a=super.get("bg");super.clear();a?(super.set("bg",a),this.cache=`bg-${a}`,window.location.hash=`bg-${a}`):(this.cache="",window.location.hash="")}}return new c})(),sha=(()=>{const c=(()=>{const b=Array.from({length:255},(d,e)=>e.toString(16).padStart(2,"0"));return d=>(new Uint8Array(d)).reduce((e,f)=>e+b[f],"")})(),a=new Set(["SHA-1","SHA-256","SHA-384","SHA-512"]);return async(b,d="SHA-256",e="hex")=>{d=d.toUpperCase();d=
a.has(d)?d:"SHA-256";b=(new TextEncoder).encode(b);b=await crypto.subtle.digest(d,b);return"base64"===e?btoa(String.fromCharCode.apply(null,new Uint8Array(b))):c(b)}})();let items=new Map;
const getImg=(()=>{const c=["nyaa","kawai","moe","desu","dere"];return a=>(a=a.shikimori_id)?`https://${c[a%c.length]}.shikimori.me/system/animes/original/${a}.jpg?${1650095057+ +a}`:"no-img.jpg"})(),parse=async c=>{const a=new Map;await Promise.all(c.map(async b=>{const d=await sha(b.imdb_id||b.kinopoisk_id||b.shikimori_id||b.worldart_link||`${b.type}${b.year}${b.title_orig}`);a.has(d)?a.get(d).top.last_episode<b.last_episode&&(a.get(d).top=b,a.get(d).ep=b.last_episode):a.set(d,{key:d,img:getImg(b),
y:b.year,ep:b.last_episode,top:b,raw:new Map,tr:new Map});a.get(d).raw.set(b.id,b);a.get(d).tr.set(b.translation.id,b.id)}));return a},buildString=c=>{const {top:a}=c;let b="";c.y&&(b+=`${c.y}\u0433. `);c.ep&&(b+=`${c.ep} \u044d\u043f. `);let d="";c.raw.forEach(e=>{""!==d&&(d+=", ");d=e===a?d+`<span class="underline">${e.translation.title}</span>`:d+e.translation.title;e.last_episode&&(d+=`[${e.last_episode}]`)});return b+d},buildHTML=c=>{let a="";c.forEach((b,d)=>{const {top:e}=b;let f,g,h;a+=`<div class="item" data-key="${d}">
<div class="left">
<div class="poster-wrapper">
  <img class="poster" src="${b.img}" alt="" />
</div>
<div class="info">
  <p class="title">${null!=(f=e.title)?f:""}</p>
  <p class="titleOrig">${null!=(g=e.title_orig)?g:""}</p>
  <p class="titleOther">${null!=(h=e.other_title)?h:""}</p>
  <p class="string">${buildString(b)}</p>
</div>
</div>
<div class="right">
<button class="right-button iframe-button">\u25b7</button>
<button class="right-button json-button">JSON</button>
</div>
</div>`});return a},sendQuery=async c=>{const a=document.getElementById("status");var b=Date.now();a.textContent="\u041f\u043e\u0438\u0441\u043a\u2026";a.style.display="block";c=await (await fetch(`${"https://metamedia.glitch.me/api/"}${c}`)).json();const {results:d}=c;b=Date.now()-b;return d&&0!==d.length?[d,b]:(a.textContent=`\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e (${b/1E3} \u0441\u0435\u043a.)`,c.error&&console.log(c.error),[[],b])},background=
document.getElementById("background"),bg$jscomp$1=Number.parseInt(hash.get("bg"),10),index$jscomp$101=bg$jscomp$1%3;index$jscomp$101?(background.src=`wallpaper/${index$jscomp$101}.mp4`,index$jscomp$101!==bg$jscomp$1&&hash.set("bg",index$jscomp$101)):hash.delete("bg");document.getElementById("background-button").addEventListener("click",()=>{let c=Number.parseInt(hash.get("bg"),10)||0;c=(c+1)%3;background.src=`wallpaper/${c}.mp4`;0===c?hash.delete("bg"):hash.set("bg",c)},{passive:!0});
document.getElementById("new-button").addEventListener("click",async()=>{hash.clear();hash.set("new");const c=document.getElementById("list"),a=document.getElementById("status");c.style.display="none";const [b,d]=await sendQuery("list?types=anime,anime-serial&limit=100");0!==b.length&&(items=new Map([...(await parse(b.reverse()))].reverse()),a.textContent=`\u041d\u0430\u0439\u0434\u0435\u043d\u043e: ${items.size} [${b.length}] (${d/1E3} \u0441\u0435\u043a.)`,c.innerHTML=buildHTML(items),c.style.display=
"block")},{passive:!0});const searchForm=document.getElementById("search-form"),searchInput=document.getElementById("search-input");
searchForm.addEventListener("submit",async c=>{c.preventDefault();const {id:a,shikimoriId:b}=c.detail||{id:null,shikimoriId:null};c=!!a||!!b;var d=searchInput.value;if(c||""!==d){c||hash.clear();c=document.getElementById("list");var e=document.getElementById("status");c.style.display="none";d=b?`shikimori_id=${encodeURI(b)}`:a?`id=${encodeURI(a)}`:d.includes("http://www.world-art.ru/cinema/cinema.php?id=")||d.includes("http://www.world-art.ru/animation/animation.php?id=")?`worldart_link=${encodeURI(d)}`:
`title=${encodeURI(d)}`;var [f,g]=await sendQuery(`search?${d}`);0!==f.length&&(items=await parse(f),a&&1<f.length&&([[,d]]=items,d.raw.has(a)&&(d.top=d.raw.get(a))),e.textContent=`\u041d\u0430\u0439\u0434\u0435\u043d\u043e: ${items.size} [${f.length}] (${g/1E3} \u0441\u0435\u043a.)`,c.innerHTML=buildHTML(items),c.style.display="block")}});
const list$jscomp$2=document.getElementById("list"),json=document.getElementById("json"),iframe=document.getElementById("iframe"),jsonOverlay=document.getElementById("json-overlay"),iframeOverlay=document.getElementById("iframe-overlay");
list$jscomp$2.addEventListener("click",({target:c})=>{var {className:a}=c;if(a.includes("iframe-button")||a.includes("json-button")){c=c.parentElement.parentElement;var {key:b}=c.dataset,d=items.get(b);({top:d}=d);a.includes("iframe-button")?(iframe.dataset.key!==b&&(iframe.src=d.link,iframe.dataset.key=b,hash.delete("new"),hash.set("shikimori",d.shikimori_id),hash.set("id",d.id),a=document.querySelector(".item.current"),a!==c&&(a&&a.classList.remove("current"),c.classList.add("current"))),iframeOverlay.style.display=
"block"):a.includes("json-button")&&items.size&&(json.textContent=JSON.stringify(items.get(b),(e,f)=>f instanceof Map?[...f.entries()]:f,"  "),jsonOverlay.style.display="block")}},{passive:!0});const iframeOverlay$jscomp$1=document.getElementById("iframe-overlay"),iframe$jscomp$1=document.getElementById("iframe");
iframeOverlay$jscomp$1.addEventListener("click",({target:c})=>{c===iframeOverlay$jscomp$1&&(iframeOverlay$jscomp$1.style.display="none",iframe$jscomp$1.contentWindow.postMessage({key:"kodik_player_api",value:{method:"pause"}},"*"))},{passive:!0});const jsonOverlay$jscomp$1=document.getElementById("json-overlay");jsonOverlay$jscomp$1.addEventListener("click",({target:c})=>{c===jsonOverlay$jscomp$1&&(jsonOverlay$jscomp$1.style.display="none")},{passive:!0});hash.has("new")&&document.getElementById("new-button").click();
if(hash.has("id")&&hash.has("ep")){const c=document.getElementById("iframe");c.addEventListener("load",()=>{let a,b;(null==(a=items.get(c.dataset.key))?void 0:null==(b=a.top)?void 0:b.id)===hash.get("id")&&c.contentWindow.postMessage({key:"kodik_player_api",value:{method:"change_episode",episode:Number.parseInt(hash.get("ep"),10)}},"*")},{once:!0,passive:!0})}const id$jscomp$7=hash.get("id"),shikimoriId$jscomp$1=hash.get("shikimori");
if(id$jscomp$7||shikimoriId$jscomp$1){const c=new CustomEvent("submit",{detail:{id:id$jscomp$7,shikimoriId:shikimoriId$jscomp$1}});document.getElementById("search-form").dispatchEvent(c)}const iframe$jscomp$3=document.getElementById("iframe");
window.addEventListener("message",({data:c})=>{const {key:a}=iframe$jscomp$3.dataset;if("kodik_player_current_episode"===(null==c?void 0:c.key)){const b=items.get(a);if(null==b?0:b.tr.has(c.value.translation.id)){const d=b.tr.get(c.value.translation.id);b.top=b.raw.get(d);hash.set("id",d);c.value.episode?(hash.set("ep",c.value.episode),document.title=`(${c.value.episode}) ${b.top.title}`):(hash.delete("ep"),document.title=b.top.title);document.querySelector(`.item[data-key="${a}"] .string`).innerHTML=
buildString(b)}}},{passive:!0});
//# sourceMappingURL=index.min.js.map
